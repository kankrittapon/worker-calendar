<!doctype html>
<html lang="th">
  <head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>Secretary ‚Ä¢ ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      :root{color-scheme:dark}
      body {
        background: linear-gradient(135deg, #0f172a 0%, #1e3a5f 50%, #2d5a7b 100%);
        min-height: 100vh;
      }
      .card {
        background: rgba(15, 23, 42, 0.7);
        backdrop-filter: blur(10px);
        border: 1px solid rgba(56, 189, 248, 0.2);
      }
      .btn-primary {
        background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
        box-shadow: 0 4px 14px 0 rgba(14, 165, 233, 0.39);
        transition: all 0.3s ease;
      }
      .btn-primary:hover {
        background: linear-gradient(135deg, #0284c7 0%, #0369a1 100%);
        box-shadow: 0 6px 20px rgba(14, 165, 233, 0.5);
        transform: translateY(-1px);
      }
    </style>
  </head>
  <body class="text-cyan-50 min-h-screen">
    <div class="max-w-6xl mx-auto p-4 space-y-4">
      <header class="flex items-center justify-between mb-6">
        <div>
          <h1 class="text-3xl md:text-4xl font-bold bg-gradient-to-r from-cyan-400 to-blue-500 bg-clip-text text-transparent">‡πÄ‡∏•‡∏Ç‡∏≤: ‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏£‡∏≤‡∏á‡∏á‡∏≤‡∏ô</h1>
          <p class="text-cyan-300/70 text-sm mt-1">‡πÄ‡∏û‡∏¥‡πà‡∏° ‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç ‡πÅ‡∏•‡∏∞‡∏•‡∏ö‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏á‡∏≤‡∏ô</p>
        </div>
        <div class="text-sm text-cyan-300/60">‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏Å‡∏≤‡∏£‡πÉ‡∏™‡πà‡∏£‡∏´‡∏±‡∏™‡πÉ‡∏ô‡∏´‡∏ô‡πâ‡∏≤‡∏ô‡∏µ‡πâ</div>
      </header>

      <section class="grid grid-cols-1 md:grid-cols-3 gap-4">
        <form id="eventForm" class="card rounded-xl p-4 space-y-3 md:col-span-2 shadow-xl">
          <h2 class="font-semibold text-cyan-400 text-lg">‡πÄ‡∏û‡∏¥‡πà‡∏°/‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏á‡∏≤‡∏ô</h2>
          <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
            <label class="grid gap-1">
              <span class="text-sm text-cyan-300/80">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà</span>
              <input name="date" type="date" required class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition"/>
            </label>
            <label class="grid gap-1">
              <span class="text-sm text-cyan-300/80">‡πÄ‡∏ß‡∏•‡∏≤</span>
              <input name="time" type="time" required class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition"/>
            </label>
            <label class="grid gap-1">
              <span class="text-sm text-cyan-300/80">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</span>
              <select name="type" required class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition">
                <option value="‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢">‡πÉ‡∏ô‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
                <option value="‡πÉ‡∏ô‡∏Å‡∏£‡∏°">‡πÉ‡∏ô‡∏Å‡∏£‡∏°</option>
                <option value="‡∏ö‡∏Å.‡πÉ‡∏´‡∏ç‡πà">‡∏ö‡∏Å.‡πÉ‡∏´‡∏ç‡πà</option>
                <option value="‡∏ô‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢">‡∏ô‡∏≠‡∏Å‡∏´‡∏ô‡πà‡∏ß‡∏¢</option>
              </select>
            </label>
            <label class="grid gap-1">
              <span class="text-sm text-cyan-300/80">‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà</span>
              <input name="location" required class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition" placeholder="‡∏™‡∏ñ‡∏≤‡∏ô‡∏ó‡∏µ‡πà"/>
            </label>
            <label class="grid gap-1 md:col-span-2">
              <span class="text-sm text-cyan-300/80">‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢</span>
              <input name="uniform" required class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition" placeholder="‡πÄ‡∏Ñ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÅ‡∏ï‡πà‡∏á‡∏Å‡∏≤‡∏¢"/>
            </label>
            <label class="grid gap-1 md:col-span-2">
              <span class="text-sm text-cyan-300/80">‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î</span>
              <input name="details" required class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition" placeholder="‡∏£‡∏≤‡∏¢‡∏•‡∏∞‡πÄ‡∏≠‡∏µ‡∏¢‡∏î"/>
            </label>
            <label class="grid gap-1 md:col-span-2">
              <span class="text-sm text-cyan-300/80">‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏</span>
              <textarea name="notes" rows="2" class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 focus:ring-2 focus:ring-cyan-400/20 outline-none transition resize-none" placeholder="‡∏£‡∏∞‡∏ö‡∏∏‡∏´‡∏°‡∏≤‡∏¢‡πÄ‡∏´‡∏ï‡∏∏ (‡∏ñ‡πâ‡∏≤‡∏°‡∏µ)"></textarea>
            </label>
          </div>
          <div class="flex gap-2">
            <button class="btn-primary px-4 py-2 rounded-lg text-slate-900 font-semibold" id="saveBtn">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô</button>
            <button type="button" class="px-4 py-2 rounded bg-slate-700/50 hover:bg-slate-600/50 transition" id="resetBtn">‡πÄ‡∏£‡∏¥‡πà‡∏°‡πÉ‡∏´‡∏°‡πà</button>
          </div>
        </form>

        <div class="card rounded-xl p-4 space-y-3 shadow-xl">
          <h2 class="font-semibold text-cyan-400">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡∏ï‡∏≤‡∏°‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h2>
          <div class="flex items-center gap-2">
            <input id="monthList" type="month" class="px-3 py-2 rounded bg-slate-800/50 border border-cyan-500/30 focus:border-cyan-400 outline-none transition"/>
            <button id="loadBtn" class="px-3 py-2 rounded bg-slate-700/50 hover:bg-slate-600/50 transition">‡πÇ‡∏´‡∏•‡∏î</button>
          </div>
        </div>
      </section>

      <section>
        <div id="list" class="space-y-2"></div>
      </section>
    </div>

    <template id="rowTpl">
      <div class="rounded-xl border border-cyan-500/30 p-4 card shadow-lg">
        <div class="flex justify-between items-start gap-3">
          <div class="flex-1 info"></div>
          <div class="flex gap-2">
            <button class="edit-btn px-3 py-1.5 bg-gradient-to-r from-blue-500 to-blue-600 hover:from-blue-600 hover:to-blue-700 text-white text-sm rounded-lg shadow transition">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
            <button class="delete-btn px-3 py-1.5 bg-gradient-to-r from-red-500 to-red-600 hover:from-red-600 hover:to-red-700 text-white text-sm rounded-lg shadow transition">‡∏•‡∏ö</button>
          </div>
        </div>
      </div>
    </template>

    <script>
      // --- Plain API helper (no password prompt here) ---
      function api(path, opts){
        opts = opts || {};
        var headers = Object.assign({'content-type':'application/json'}, (opts.headers||{}));
        return fetch(path, Object.assign({}, opts, { credentials:'include', headers: headers }))
          .then(function(res){
            if(!res.ok){
              return res.text().then(function(t){ throw new Error('API '+res.status+': '+t); });
            }
            return res.json();
          });
      }

      function fmt(y,m,d){ return y+'-'+('0'+m).slice(-2)+'-'+('0'+d).slice(-2); }
      function initMonthPicker(){
        var now = new Date();
        var v = now.getFullYear() + '-' + ('0'+(now.getMonth()+1)).slice(-2);
        document.getElementById('monthList').value = v;
      }

      function renderRow(ev){
        var tpl = document.getElementById('rowTpl').content.cloneNode(true);
        var info = tpl.querySelector('.info');
        
        var header = document.createElement('div');
        header.className = 'font-semibold text-cyan-300';
        header.textContent = ev.date + ' ' + ev.time + ' ‚Äî ' + ev.type;
        
        var locationUniform = document.createElement('div');
        locationUniform.className = 'text-cyan-100/80 mt-1';
        locationUniform.textContent = 'üìç ' + ev.location + ' ‚Ä¢ üëî ' + ev.uniform;
        
        var details = document.createElement('div');
        details.className = 'text-cyan-200/70 mt-1';
        details.textContent = ev.details;
        
        info.appendChild(header);
        info.appendChild(locationUniform);
        info.appendChild(details);
        
        if (ev.notes) {
          var notes = document.createElement('div');
          notes.className = 'text-cyan-300/60 mt-1 text-sm italic';
          notes.textContent = 'üìù ' + ev.notes;
          info.appendChild(notes);
        }

        tpl.querySelector('.edit-btn').addEventListener('click', function(){
          var f = document.getElementById('eventForm');
          f.dataset.editId = ev.id;
          f.date.value = ev.date;
          f.time.value = ev.time;
          f.type.value = ev.type;
          f.location.value = ev.location;
          f.uniform.value = ev.uniform;
          f.details.value = ev.details;
          f.notes.value = ev.notes || '';
          document.getElementById('saveBtn').textContent = '‡∏≠‡∏±‡∏õ‡πÄ‡∏î‡∏ï‡∏á‡∏≤‡∏ô';
          f.scrollIntoView({behavior:'smooth'});
        });
        tpl.querySelector('.delete-btn').addEventListener('click', function(){
          if(confirm('‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£‡∏•‡∏ö‡∏á‡∏≤‡∏ô‡∏ô‡∏µ‡πâ‡∏´‡∏£‡∏∑‡∏≠‡πÑ‡∏°‡πà?')){
            api('/api/events/'+ev.id, { method:'DELETE' })
              .then(loadList)
              .catch(function(e){ alert(e.message); });
          }
        });
        return tpl;
      }

      function loadList(){
        var month = document.getElementById('monthList').value;
        var list = document.getElementById('list'); list.innerHTML = '';
        return api('/api/events?month='+month)
          .then(function(items){
            (Array.isArray(items)?items:[]).forEach(function(ev){
              list.appendChild(renderRow(ev));
            });
          })
          .catch(function(e){
            var errorDiv = document.createElement('div');
            errorDiv.className = 'text-red-400 p-4 card rounded-xl text-center';
            errorDiv.textContent = '‡πÇ‡∏´‡∏•‡∏î‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: ' + e.message;
            list.appendChild(errorDiv);
          });
      }

      document.getElementById('eventForm').addEventListener('submit', function(e){
        e.preventDefault();
        var f = e.target;
        var data = {
          date: f.date.value,
          time: f.time.value,
          type: f.type.value,
          location: f.location.value,
          uniform: f.uniform.value,
          details: f.details.value,
          notes: f.notes.value
        };
        var req;
        if (f.dataset.editId){
          req = api('/api/events/'+f.dataset.editId, { method:'PUT', body: JSON.stringify(data) });
        } else {
          req = api('/api/events', { method:'POST', body: JSON.stringify(data) });
        }
        req.then(function(){
          f.reset();
          delete f.dataset.editId;
          document.getElementById('saveBtn').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô';
          return loadList();
        }).catch(function(e){
          alert('‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÑ‡∏°‡πà‡∏™‡∏≥‡πÄ‡∏£‡πá‡∏à: '+e.message);
        });
      });

      document.getElementById('resetBtn').addEventListener('click', function(){
        var f = document.getElementById('eventForm');
        f.reset();
        delete f.dataset.editId;
        document.getElementById('saveBtn').textContent = '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏á‡∏≤‡∏ô';
      });

      document.getElementById('loadBtn').addEventListener('click', function(e){
        e.preventDefault();
        loadList();
      });

      // Init
      initMonthPicker();
      loadList();
    </script>
  </body>
</html>
